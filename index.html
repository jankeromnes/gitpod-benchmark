<!doctype html>
<meta charset="utf-8">
<title>Gitpod vs laptop</title>
<style>
    .charts {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
    }
    .charts > div {
        width: 600px;
        margin: 30px;
    }
</style>
<body>
    <div id="starts" class="charts"></div>
    <div id="builds" class="charts"></div>
    <pre id="data"></pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-adapter-moment/1.0.0/chartjs-adapter-moment.min.js"></script>
    <script>
        const toSeconds = (d) => {
            d.start = Math.round(10 * d.start / 1000) / 10;
            d.build = Math.round(10 * d.build / 1000) / 10;
            return d;
        };

        const plot = (data) => {
            const div = document.createElement("div");
            const canvas = document.createElement("canvas");
            div.appendChild(canvas);
            document.querySelector("#builds").appendChild(div);
            const ctx = canvas.getContext("2d");
            const chart = new Chart(ctx, {
                type: "line",
                data: {
                    datasets: [{
                        label: "workspace",
                        borderColor: "#ff8a00",
                        data: data.datasets.workspace.map(toSeconds),
                    }, {
                        label: "prebuild",
                        borderColor: "#ffb45b",
                        data: data.datasets.prebuild.map(toSeconds),
                    }, {
                        label: "laptop",
                        data: data.datasets.laptop.map(toSeconds),
                    }],
                },
                options: {
                    parsing: {
                        yAxisKey: "build",
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: "Build: " + data.title,
                        },
                    },
                    scales: {
                        x: {
                            type: "time",
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: "seconds",
                            },
                        },
                    },
                },
            });
        };

        fetch("./db.json").then(res => res.json()).then(db => {
            document.querySelector("#data").textContent = JSON.stringify(db, null, 4);
            for (const repo in db.repositories) {
                plot(db.repositories[repo]);
            }
        });
    </script>
</body>
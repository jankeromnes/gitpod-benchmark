<!doctype html>
<meta charset="utf-8">
<title>Gitpod vs local</title>
<style>
    .charts {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
    }
    .charts > div {
        width: 650px;
        margin: 20px;
    }
</style>
<body>
    <div id="starts" class="charts"></div>
    <div id="builds" class="charts"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-adapter-moment/1.0.0/chartjs-adapter-moment.min.js"></script>
    <script>
        const toMinutes = (d) => {
            return {
                x: d.x,
                start: Math.round(100 * d.start / (1000 * 60)) / 100,
                build: Math.round(100 * d.build / (1000 * 60)) / 100,
            };
        };

        const seriesTitle = {
            start: "Start-up time",
            build: "Build time",
        };

        const plot = (data, series) => {
            const div = document.createElement("div");
            const canvas = document.createElement("canvas");
            div.appendChild(canvas);
            const ctx = canvas.getContext("2d");
            const chart = new Chart(ctx, {
                type: "line",
                data: {
                    datasets: [{
                        label: "workspace",
                        borderColor: "#ff8a00",
                        data: data.datasets.workspace.map(toMinutes),
                    }, {
                        label: "prebuild",
                        borderColor: "#ffb45b",
                        data: data.datasets.prebuild.map(toMinutes),
                    }, {
                        label: "local",
                        data: data.datasets.local.map(toMinutes),
                    }],
                },
                options: {
                    parsing: {
                        yAxisKey: series,
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: seriesTitle[series] + ": " + data.title,
                        },
                    },
                    scales: {
                        x: {
                            type: "time",
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: "minutes",
                            },
                        },
                    },
                },
            });
            return div;
        };

        fetch("./db.json").then(res => res.json()).then(db => {
            for (const repo in db.repositories) {
                document.querySelector("#starts").appendChild(plot(db.repositories[repo], "start"));
                document.querySelector("#builds").appendChild(plot(db.repositories[repo], "build"));
            }
        });
    </script>
</body>